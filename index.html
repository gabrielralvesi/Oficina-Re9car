<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RenoveCar Pro</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        :root { --primary: #e63946; --secondary: #1e1e2f; --success: #2ecc71; --warning: #f39c12; --danger: #e74c3c; --light: #f8f9fa; --gray: #6c757d; --border: #dee2e6; }
        body { background: linear-gradient(135deg, #667eea, #764ba2); padding: 15px; min-height: 100vh; }
        .dashboard { max-width: 1400px; margin: 0 auto; }
        
        /* Header */
        .header { background: var(--primary); color: white; padding: 20px; border-radius: 15px 15px 0 0; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
        .logo h1 { font-size: 24px; display: flex; align-items: center; gap: 10px; }
        .user-badge { background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 30px; display: flex; align-items: center; gap: 8px; }
        .date-time { font-size: 13px; background: rgba(0,0,0,0.2); padding: 8px 15px; border-radius: 30px; }
        
        /* Menu */
        .nav-menu { background: white; padding: 0 15px; display: flex; gap: 5px; border-bottom: 1px solid var(--border); overflow-x: auto; }
        .nav-item { padding: 12px 18px; cursor: pointer; color: var(--gray); display: flex; align-items: center; gap: 8px; border-bottom: 3px solid transparent; }
        .nav-item.active { color: var(--primary); border-bottom-color: var(--primary); }
        
        /* Conte√∫do */
        .content { background: white; padding: 25px; border-radius: 0 0 15px 15px; min-height: 500px; }
        
        /* Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); gap: 15px; margin-bottom: 25px; }
        .stat-card { background: var(--secondary); color: white; padding: 18px; border-radius: 12px; display: flex; justify-content: space-between; }
        .stat-info .value { font-size: 22px; font-weight: 700; }
        .stat-icon { font-size: 40px; opacity: 0.3; }
        
        /* Gr√°ficos */
        .charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
        .chart-card { border: 1px solid var(--border); border-radius: 12px; padding: 18px; }
        
        /* Formul√°rios */
        .form-section { background: var(--light); border-radius: 12px; padding: 20px; margin-bottom: 25px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap: 15px; margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 500; font-size: 13px; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 2px solid var(--border); border-radius: 8px; }
        
        /* Bot√µes */
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-outline { background: transparent; border: 2px solid var(--border); color: var(--gray); }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        
        /* Tabelas */
        .table-container { overflow-x: auto; border-radius: 10px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; min-width: 700px; }
        th { background: var(--secondary); color: white; padding: 12px; }
        td { padding: 10px; border-bottom: 1px solid var(--border); }
        
        /* Badges */
        .badge { padding: 4px 8px; border-radius: 20px; font-size: 11px; font-weight: 600; }
        .badge-success { background: #d4edda; color: #155724; }
        .badge-danger { background: #f8d7da; color: #721c24; }
        .badge-warning { background: #fff3cd; color: #856404; }
        
        /* Servi√ßos */
        .servico-linha { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; background: white; padding: 10px; border-radius: 8px; }
        .servico-descricao { flex: 3; }
        .servico-valor { flex: 1; }
        .btn-remove { background: var(--danger); color: white; width: 30px; height: 30px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-add { background: var(--success); color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; margin: 10px 0; }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 12px; width: 90%; max-width: 500px; }
        .modal-header { padding: 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; }
        .modal-body { padding: 20px; }
        .modal-footer { padding: 15px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 10px; }
        
        /* Toast */
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 1001; }
        .toast { background: white; border-radius: 8px; padding: 12px 18px; margin-bottom: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); display: flex; align-items: center; gap: 10px; border-left: 4px solid; }
        .toast.success { border-left-color: var(--success); }
        .toast.error { border-left-color: var(--danger); }
        
        /* Loading */
        .loading { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.9); align-items: center; justify-content: center; }
        .loading.active { display: flex; }
        .spinner { width: 45px; height: 45px; border: 4px solid var(--border); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Tabs */
        .tabs { display: flex; gap: 2px; background: var(--light); padding: 5px; border-radius: 8px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab { padding: 8px 15px; cursor: pointer; border-radius: 6px; color: var(--gray); }
        .tab.active { background: white; color: var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        
        @media (max-width: 768px) { .charts-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <h1><i class="fas fa-car"></i> RenoveCar Pro</h1>
            </div>
            <div style="display: flex; gap: 15px; align-items: center;">
                <div class="user-badge"><i class="fas fa-user-circle"></i> Admin</div>
                <div class="date-time" id="currentDateTime"></div>
                <button class="btn btn-sm btn-outline" onclick="logout()"><i class="fas fa-sign-out-alt"></i></button>
            </div>
        </div>

        <!-- Menu -->
        <div class="nav-menu">
            <div class="nav-item active" onclick="showSection('dashboard', this)"><i class="fas fa-chart-pie"></i> Dashboard</div>
            <div class="nav-item" onclick="showSection('os', this)"><i class="fas fa-clipboard-list"></i> OS</div>
            <div class="nav-item" onclick="showSection('caixa', this)"><i class="fas fa-cash-register"></i> Caixa</div>
            <div class="nav-item" onclick="showSection('clientes', this)"><i class="fas fa-users"></i> Clientes</div>
            <div class="nav-item" onclick="showSection('notificacoes', this)"><i class="fas fa-bell"></i> Alertas <span class="badge badge-danger" id="notificacaoCount">0</span></div>
        </div>

        <!-- Conte√∫do -->
        <div class="content" id="mainContent"></div>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header"><h2 id="modalTitle"></h2><button class="close-modal" onclick="closeModal()">&times;</button></div>
            <div class="modal-body" id="modalBody"></div>
            <div class="modal-footer"><button class="btn btn-outline" onclick="closeModal()">Cancelar</button><button class="btn btn-primary" id="modalConfirmBtn">OK</button></div>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast-container" id="toastContainer"></div>
    <div class="loading" id="loading"><div class="spinner"></div></div>

    <script>
        // Estado global
        const App = {
            section: 'dashboard',
            charts: {},
            data: { caixa: [], clientes: [], os: [], notificacoes: [] },
            servicos: []
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            showLoading();
            loadData();
            updateDateTime();
            setInterval(updateDateTime, 1000);
            verificarNotificacoes();
            setInterval(verificarNotificacoes, 3600000);
            setTimeout(() => { renderSection('dashboard'); hideLoading(); }, 500);
        });

        // Utilit√°rios
        const showLoading = () => document.getElementById('loading').classList.add('active');
        const hideLoading = () => document.getElementById('loading').classList.remove('active');
        const showToast = (msg, type = 'info') => {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i> ${msg}`;
            document.getElementById('toastContainer').appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        };
        const updateDateTime = () => document.getElementById('currentDateTime').textContent = new Date().toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' });

        // Dados
        const loadData = () => {
            try {
                App.data = JSON.parse(localStorage.getItem('renovecar')) || {
                    caixa: [{ id: 1, tipo: 'entrada', desc: 'OS #001', valor: 350, data: new Date().toISOString().split('T')[0] }],
                    clientes: [{ id: 1, nome: 'Jo√£o Silva', tel: '(11)99999-9999', veic: 'Gol 2020', placa: 'ABC-1234', km: 45230 }],
                    os: [{ id: 1, numero: 'OS-001', clienteId: 1, clienteNome: 'Jo√£o Silva', veiculo: 'Gol 2020', placa: 'ABC-1234', kmEntrada: 45230, data: new Date().toISOString().split('T')[0], status: 'concluido', servicos: [{ desc: 'Troca de √ìleo', valor: 150 }], total: 150 }],
                    notificacoes: []
                };
            } catch { App.data = { caixa: [], clientes: [], os: [], notificacoes: [] }; }
        };
        const saveData = () => localStorage.setItem('renovecar', JSON.stringify(App.data));

        // Notifica√ß√µes
        const verificarNotificacoes = () => {
            App.data.notificacoes = App.data.clientes.filter(c => {
                const ultimaOS = App.data.os.filter(o => o.clienteId === c.id).sort((a,b) => new Date(b.data) - new Date(a.data))[0];
                return ultimaOS && (new Date() - new Date(ultimaOS.data)) / (1000*60*60*24) > 90;
            }).map(c => ({ clienteNome: c.nome, msg: 'Revis√£o recomendada', prioridade: 'media' }));
            document.getElementById('notificacaoCount').textContent = App.data.notificacoes.length;
        };

        // Navega√ß√£o
        const showSection = (section, el) => {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            App.section = section;
            renderSection(section);
        };

        const renderSection = (section) => {
            const content = document.getElementById('mainContent');
            showLoading();
            setTimeout(() => {
                content.innerHTML = {
                    dashboard: renderDashboard,
                    os: renderOS,
                    caixa: renderCaixa,
                    clientes: renderClientes,
                    notificacoes: renderNotificacoes
                }[section]();
                if (section === 'dashboard') setTimeout(initCharts, 100);
                hideLoading();
            }, 300);
        };

        // ==================== DASHBOARD ====================
        const renderDashboard = () => {
            const mes = new Date().getMonth();
            const entradas = App.data.caixa.filter(i => i.tipo === 'entrada' && new Date(i.data).getMonth() === mes).reduce((s,i) => s + i.valor, 0);
            const saidas = App.data.caixa.filter(i => i.tipo === 'saida' && new Date(i.data).getMonth() === mes).reduce((s,i) => s + i.valor, 0);
            
            return `
                <div class="stats-grid">
                    <div class="stat-card"><div><h3>Saldo</h3><div class="value">R$ ${(entradas-saidas).toFixed(2)}</div></div><i class="fas fa-chart-line stat-icon"></i></div>
                    <div class="stat-card"><div><h3>OS M√™s</h3><div class="value">${App.data.os.filter(o => new Date(o.data).getMonth() === mes).length}</div></div><i class="fas fa-clipboard-list stat-icon"></i></div>
                    <div class="stat-card"><div><h3>Clientes</h3><div class="value">${App.data.clientes.length}</div></div><i class="fas fa-users stat-icon"></i></div>
                    <div class="stat-card"><div><h3>Alertas</h3><div class="value">${App.data.notificacoes.length}</div></div><i class="fas fa-bell stat-icon"></i></div>
                </div>
                <div class="charts-grid">
                    <div class="chart-card"><h3>Fluxo de Caixa</h3><canvas id="fluxoChart"></canvas></div>
                    <div class="chart-card"><h3>Status OS</h3><canvas id="statusChart"></canvas></div>
                </div>
                <div class="form-section">
                    <h3>√öltimas OS</h3>
                    <div class="table-container">
                        <table><thead><tr><th>N¬∫</th><th>Cliente</th><th>Valor</th><th>Status</th></tr></thead>
                        <tbody>${App.data.os.slice(0,5).map(o => `<tr><td>${o.numero}</td><td>${o.clienteNome}</td><td>R$ ${o.total}</td><td><span class="badge ${o.status === 'concluido' ? 'badge-success' : 'badge-warning'}">${o.status}</span></td></tr>`).join('')}</tbody>
                        </table>
                    </div>
                </div>
            `;
        };

        const initCharts = () => {
            const ctx1 = document.getElementById('fluxoChart')?.getContext('2d');
            if (ctx1) new Chart(ctx1, { type: 'line', data: { labels: ['Seg','Ter','Qua','Qui','Sex','S√°b','Dom'], datasets: [{ label: 'Entradas', data: [1200,1900,1500,1800,2100,1600,1400], borderColor: '#2ecc71' }] } });
            const ctx2 = document.getElementById('statusChart')?.getContext('2d');
            if (ctx2) new Chart(ctx2, { type: 'doughnut', data: { labels: ['Conclu√≠das','Andamento'], datasets: [{ data: [App.data.os.filter(o => o.status === 'concluido').length || 1, App.data.os.filter(o => o.status === 'andamento').length || 1], backgroundColor: ['#2ecc71','#f39c12'] }] } });
        };

        // ==================== OS ====================
        const renderOS = () => `
            <div class="tabs">
                <div class="tab active" onclick="mostrarSubOS('nova')">‚ûï Nova</div>
                <div class="tab" onclick="mostrarSubOS('ativas')">üîß Ativas</div>
                <div class="tab" onclick="mostrarSubOS('historico')">üìã Hist√≥rico</div>
            </div>
            <div id="subOS">${renderNovaOS()}</div>
        `;

        const mostrarSubOS = (secao) => {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.getElementById('subOS').innerHTML = secao === 'nova' ? renderNovaOS() : secao === 'ativas' ? renderOSAtivas() : renderOSHistorico();
        };

        const renderNovaOS = () => {
            App.servicos = App.servicos.length ? App.servicos : [{ desc: '', valor: 0 }];
            return `
                <div class="form-section">
                    <div class="form-grid">
                        <select id="osCliente" onchange="carregarCliente()"><option value="">Cliente</option>${App.data.clientes.map(c => `<option value="${c.id}" data-veic="${c.veic}" data-placa="${c.placa}" data-km="${c.km}">${c.nome}</option>`).join('')}</select>
                        <input type="text" id="osVeic" placeholder="Ve√≠culo" readonly>
                        <input type="text" id="osPlaca" placeholder="Placa" readonly>
                        <input type="number" id="osKm" placeholder="KM" readonly>
                        <input type="date" id="osData" value="${new Date().toISOString().split('T')[0]}">
                    </div>
                    <h4>Servi√ßos</h4>
                    <div id="servicosContainer">${App.servicos.map((s,i) => `
                        <div class="servico-linha">
                            <input class="servico-descricao" placeholder="Descri√ß√£o" value="${s.desc}" onchange="atualizarServico(${i}, 'desc', this.value)">
                            <input class="servico-valor" type="number" placeholder="Valor" value="${s.valor}" onchange="atualizarServico(${i}, 'valor', this.value)">
                            ${App.servicos.length > 1 ? `<button class="btn-remove" onclick="removerServico(${i})"><i class="fas fa-times"></i></button>` : ''}
                        </div>`).join('')}
                    </div>
                    <button class="btn-add" onclick="adicionarServico()"><i class="fas fa-plus"></i> Servi√ßo</button>
                    <div style="background: var(--secondary); color: white; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <div style="display: flex; justify-content: space-between;"><span>Total:</span><span style="font-size: 24px; font-weight: bold;" id="osTotal">R$ ${App.servicos.reduce((s,i) => s + (parseFloat(i.valor)||0), 0).toFixed(2)}</span></div>
                    </div>
                    <textarea id="osObs" rows="2" placeholder="Observa√ß√µes"></textarea>
                    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 15px;">
                        <button class="btn btn-outline" onclick="limparOS()">Limpar</button>
                        <button class="btn btn-success" onclick="salvarOS()">Salvar OS</button>
                    </div>
                </div>
            `;
        };

        const adicionarServico = () => { App.servicos.push({ desc: '', valor: 0 }); document.getElementById('servicosContainer').innerHTML = renderServicosLinhas(); };
        const removerServico = (i) => { App.servicos.splice(i,1); document.getElementById('servicosContainer').innerHTML = renderServicosLinhas(); calcularTotal(); };
        const renderServicosLinhas = () => App.servicos.map((s,i) => `
            <div class="servico-linha">
                <input class="servico-descricao" value="${s.desc}" onchange="atualizarServico(${i}, 'desc', this.value)">
                <input class="servico-valor" type="number" value="${s.valor}" onchange="atualizarServico(${i}, 'valor', this.value)">
                ${App.servicos.length > 1 ? `<button class="btn-remove" onclick="removerServico(${i})"><i class="fas fa-times"></i></button>` : ''}
            </div>`).join('');
        const atualizarServico = (i, campo, valor) => { App.servicos[i][campo] = campo === 'valor' ? parseFloat(valor)||0 : valor; calcularTotal(); };
        const calcularTotal = () => document.getElementById('osTotal').textContent = `R$ ${App.servicos.reduce((s,i) => s + (i.valor||0), 0).toFixed(2)}`;

        const carregarCliente = () => {
            const opt = document.getElementById('osCliente').selectedOptions[0];
            document.getElementById('osVeic').value = opt?.dataset.veic || '';
            document.getElementById('osPlaca').value = opt?.dataset.placa || '';
            document.getElementById('osKm').value = opt?.dataset.km || '';
        };

        const salvarOS = () => {
            const clienteId = document.getElementById('osCliente').value;
            if (!clienteId) return showToast('Selecione um cliente', 'warning');
            const servicosValidos = App.servicos.filter(s => s.desc.trim() && s.valor > 0);
            if (!servicosValidos.length) return showToast('Adicione servi√ßos', 'warning');
            
            const cliente = App.data.clientes.find(c => c.id == clienteId);
            const novaOS = {
                id: Date.now(),
                numero: `OS-${String(App.data.os.length+1).padStart(3,'0')}`,
                clienteId: parseInt(clienteId),
                clienteNome: cliente.nome,
                veiculo: cliente.veic,
                placa: cliente.placa,
                kmEntrada: parseInt(document.getElementById('osKm').value),
                data: document.getElementById('osData').value,
                status: 'andamento',
                servicos: servicosValidos.map(s => ({ desc: s.desc, valor: s.valor })),
                total: servicosValidos.reduce((s,i) => s + i.valor, 0),
                obs: document.getElementById('osObs').value
            };
            
            App.data.os.push(novaOS);
            saveData();
            showToast('OS criada!', 'success');
            limparOS();
        };

        const limparOS = () => {
            document.getElementById('osCliente').value = '';
            document.getElementById('osVeic').value = '';
            document.getElementById('osPlaca').value = '';
            document.getElementById('osKm').value = '';
            document.getElementById('osObs').value = '';
            App.servicos = [{ desc: '', valor: 0 }];
            document.getElementById('servicosContainer').innerHTML = renderServicosLinhas();
            document.getElementById('osTotal').textContent = 'R$ 0.00';
        };

        const renderOSAtivas = () => App.data.os.filter(o => o.status === 'andamento').length ? `
            <div class="table-container"><table><thead><tr><th>N¬∫</th><th>Cliente</th><th>Ve√≠culo</th><th>Valor</th><th></th></tr></thead>
            <tbody>${App.data.os.filter(o => o.status === 'andamento').map(o => `<tr><td>${o.numero}</td><td>${o.clienteNome}</td><td>${o.veiculo}</td><td>R$ ${o.total}</td><td><button class="btn-sm btn-success" onclick="concluirOS(${o.id})">Concluir</button></td></tr>`).join('')}</tbody>
            </table></div>` : '<p>Nenhuma OS ativa</p>';

        const renderOSHistorico = () => `<div class="table-container"><table><thead><tr><th>N¬∫</th><th>Cliente</th><th>Data</th><th>Valor</th></tr></thead>
            <tbody>${App.data.os.filter(o => o.status === 'concluido').map(o => `<tr><td>${o.numero}</td><td>${o.clienteNome}</td><td>${o.data}</td><td>R$ ${o.total}</td></tr>`).join('')}</tbody>
            </table></div>`;

        const concluirOS = (id) => {
            const os = App.data.os.find(o => o.id === id);
            if (os && confirm('Concluir OS?')) {
                os.status = 'concluido';
                os.dataSaida = new Date().toISOString().split('T')[0];
                App.data.caixa.unshift({ id: Date.now(), tipo: 'entrada', desc: `OS ${os.numero}`, valor: os.total, data: os.dataSaida });
                saveData();
                showToast('OS conclu√≠da', 'success');
                renderSection('os');
                verificarNotificacoes();
            }
        };

        // ==================== CAIXA ====================
        const renderCaixa = () => {
            const entradas = App.data.caixa.filter(i => i.tipo === 'entrada').reduce((s,i) => s + i.valor, 0);
            const saidas = App.data.caixa.filter(i => i.tipo === 'saida').reduce((s,i) => s + i.valor, 0);
            return `
                <div class="form-section">
                    <div class="form-grid">
                        <select id="tipoCaixa"><option value="entrada">Entrada</option><option value="saida">Sa√≠da</option></select>
                        <input type="text" id="descCaixa" placeholder="Descri√ß√£o">
                        <input type="number" id="valorCaixa" placeholder="Valor" step="0.01">
                        <input type="date" id="dataCaixa" value="${new Date().toISOString().split('T')[0]}">
                    </div>
                    <button class="btn btn-primary" onclick="registrarCaixa()">Registrar</button>
                </div>
                <div class="table-container">
                    <table><thead><tr><th>Data</th><th>Tipo</th><th>Descri√ß√£o</th><th>Valor</th><th></th></tr></thead>
                    <tbody>${App.data.caixa.sort((a,b) => new Date(b.data)-new Date(a.data)).map(i => `<tr><td>${i.data}</td><td><span class="badge ${i.tipo==='entrada'?'badge-success':'badge-danger'}">${i.tipo}</span></td><td>${i.desc}</td><td>R$ ${i.valor}</td><td><button class="btn-icon btn-delete" onclick="excluirRegistro(${i.id})"><i class="fas fa-trash"></i></button></td></tr>`).join('')}</tbody>
                    <tfoot><tr><td colspan="3">Entradas: R$ ${entradas.toFixed(2)}</td><td colspan="2">Sa√≠das: R$ ${saidas.toFixed(2)} | Saldo: R$ ${(entradas-saidas).toFixed(2)}</td></tr></tfoot>
                    </table>
                </div>
            `;
        };

        const registrarCaixa = () => {
            const tipo = document.getElementById('tipoCaixa').value;
            const desc = document.getElementById('descCaixa').value;
            const valor = parseFloat(document.getElementById('valorCaixa').value);
            if (!desc || !valor) return showToast('Preencha tudo', 'warning');
            App.data.caixa.unshift({ id: Date.now(), tipo, desc, valor, data: document.getElementById('dataCaixa').value });
            saveData();
            renderSection('caixa');
            showToast('Registrado', 'success');
        };

        const excluirRegistro = (id) => { if (confirm('Excluir?')) { App.data.caixa = App.data.caixa.filter(i => i.id !== id); saveData(); renderSection('caixa'); } };

        // ==================== CLIENTES ====================
        const renderClientes = () => `
            <div class="tabs"><div class="tab active" onclick="mostrarSubCliente('cad')">üìù Cadastro</div><div class="tab" onclick="mostrarSubCliente('lista')">üìã Lista</div></div>
            <div id="subCliente">${renderCadastroCliente()}</div>
        `;

        const mostrarSubCliente = (s) => {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.getElementById('subCliente').innerHTML = s === 'cad' ? renderCadastroCliente() : renderListaClientes();
        };

        const renderCadastroCliente = () => `
            <div class="form-section">
                <div class="form-grid">
                    <input type="text" id="nomeCliente" placeholder="Nome">
                    <input type="text" id="telCliente" placeholder="Telefone">
                    <input type="text" id="veicCliente" placeholder="Ve√≠culo">
                    <input type="text" id="placaCliente" placeholder="Placa">
                    <input type="number" id="kmCliente" placeholder="KM Atual">
                </div>
                <button class="btn btn-primary" onclick="cadastrarCliente()">Cadastrar</button>
            </div>
        `;

        const renderListaClientes = () => `
            <input type="text" id="buscaCliente" placeholder="Buscar..." onkeyup="buscarClientes()" style="width:100%; padding:10px; margin-bottom:15px;">
            <div class="table-container"><table><thead><tr><th>Nome</th><th>Telefone</th><th>Ve√≠culo</th><th>KM</th><th></th></tr></thead>
            <tbody id="tabelaClientes">${App.data.clientes.map(c => `<tr><td>${c.nome}</td><td>${c.tel}</td><td>${c.veic}</td><td>${c.km} km</td><td><button class="btn-icon btn-delete" onclick="excluirCliente(${c.id})"><i class="fas fa-trash"></i></button></td></tr>`).join('')}</tbody>
            </table></div>
        `;

        const cadastrarCliente = () => {
            const n = document.getElementById('nomeCliente').value, t = document.getElementById('telCliente').value, v = document.getElementById('veicCliente').value, p = document.getElementById('placaCliente').value, k = parseInt(document.getElementById('kmCliente').value);
            if (!n || !t || !v || !p || !k) return showToast('Preencha tudo', 'warning');
            App.data.clientes.push({ id: Date.now(), nome: n, tel: t, veic: v, placa: p.toUpperCase(), km: k });
            saveData();
            showToast('Cliente cadastrado', 'success');
            ['nomeCliente','telCliente','veicCliente','placaCliente','kmCliente'].forEach(id => document.getElementById(id).value = '');
        };

        const buscarClientes = () => {
            const termo = document.getElementById('buscaCliente').value.toLowerCase();
            const filtrados = App.data.clientes.filter(c => c.nome.toLowerCase().includes(termo) || c.placa.toLowerCase().includes(termo));
            document.getElementById('tabelaClientes').innerHTML = filtrados.map(c => `<tr><td>${c.nome}</td><td>${c.tel}</td><td>${c.veic}</td><td>${c.km} km</td><td><button class="btn-icon btn-delete" onclick="excluirCliente(${c.id})"><i class="fas fa-trash"></i></button></td></tr>`).join('');
        };

        const excluirCliente = (id) => { if (confirm('Excluir?')) { App.data.clientes = App.data.clientes.filter(c => c.id !== id); saveData(); renderSection('clientes'); } };

        // ==================== NOTIFICA√á√ïES ====================
        const renderNotificacoes = () => `
            <div class="form-section">
                <h3>Alertas</h3>
                ${App.data.notificacoes.length ? `<div class="table-container"><table><thead><tr><th>Cliente</th><th>Mensagem</th><th>Prioridade</th></tr></thead>
                <tbody>${App.data.notificacoes.map(n => `<tr><td>${n.clienteNome}</td><td>${n.msg}</td><td><span class="badge ${n.prioridade==='alta'?'badge-danger':'badge-warning'}">${n.prioridade}</span></td></tr>`).join('')}</tbody>
                </table></div>` : '<p>Sem alertas</p>'}
            </div>
        `;

        // Modal
        const openModal = (title, content) => { document.getElementById('modalTitle').textContent = title; document.getElementById('modalBody').innerHTML = content; document.getElementById('modal').classList.add('active'); };
        const closeModal = () => document.getElementById('modal').classList.remove('active');
        const logout = () => confirm('Sair?') && showToast('At√© logo', 'info');
    </script>
</body>
</html>
